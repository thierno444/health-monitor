<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-purple-900/20 dark:to-indigo-900/20 theme-transition">
  <!-- Toast notifications -->
  <app-toast></app-toast>

  <!-- Navbar -->
  <nav class="glass-nav border-b border-white/20 dark:border-purple-500/30 sticky top-0 z-40 backdrop-blur-xl">
    <div class="container mx-auto px-4 sm:px-6 py-3">
      <div class="flex flex-col sm:flex-row items-center justify-between">
        <!-- Logo avec gradient -->
        <div class="flex items-center space-x-3 mb-3 sm:mb-0">
          <div class="relative">
            <!-- Glow effect -->
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl blur-lg opacity-50"></div>
            <!-- Logo -->
            <div class="relative p-2 sm:p-2.5 bg-gradient-to-br from-blue-500 via-purple-600 to-pink-500 rounded-2xl shadow-2xl">
              <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
            </div>
          </div>
          <div>
            <h1 class="text-base sm:text-xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">
              Dashboard M√©decin
            </h1>
            <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 font-medium">Suivi patients en temps r√©el</p>
          </div>
        </div>

        <!-- Actions avec effets -->
        <!-- Actions avec effets - R√âORGANIS√â POUR MOBILE -->
      <div class="flex items-center gap-2 sm:gap-3 w-full sm:w-auto justify-between sm:justify-end mt-3 sm:mt-0">
        
        <!-- Groupe 1: Notifications + Th√®me (align√©s √† gauche sur mobile) -->
        <div class="flex items-center gap-2">
          <!-- Notifications -->
          <app-notifications-dropdown class="flex-shrink-0 w-8 h-8 sm:w-auto sm:h-auto"></app-notifications-dropdown>

          <!-- Toggle Dark/Light -->
          <button
            (click)="toggleTheme()"
            class="p-1.5 sm:p-2 rounded-xl bg-gradient-to-br from-yellow-400 to-orange-500 dark:from-indigo-500 dark:to-purple-600 hover:scale-110 transition-all shadow-lg flex-shrink-0"
            [title]="darkMode ? 'Mode clair' : 'Mode sombre'"
            aria-label="Changer le th√®me"
          >
            <svg *ngIf="!darkMode" class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
            <svg *ngIf="darkMode" class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
          </button>
        </div>

        <!-- Groupe 2: Profil + D√©connexion (align√©s √† droite sur mobile) -->
        <div class="flex items-center gap-2">
          <!-- Profil avec hover effect -->
          <div class="flex items-center space-x-2 px-2 py-1.5 sm:px-3 sm:py-2 rounded-xl hover:bg-white/50 dark:hover:bg-purple-500/20 transition-all cursor-pointer group flex-shrink-0">
            <div class="relative">
              <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full blur opacity-50 group-hover:opacity-75 transition-opacity"></div>
              <img
                [src]="user?.photoProfil || 'https://ui-avatars.com/api/?name=' + (user?.prenom || 'M') + '+' + (user?.nom || 'D') + '&background=8B5CF6&color=fff'"
                class="relative w-7 h-7 sm:w-10 sm:h-10 rounded-full border-2 border-purple-500 shadow-lg"
                [alt]="user?.prenom + ' ' + user?.nom"
              >
            </div>
            <div class="hidden sm:block">
              <p class="text-xs sm:text-sm font-bold text-gray-900 dark:text-white truncate max-w-[120px]">Dr. {{ user?.prenom }} {{ user?.nom }}</p>
              <p class="text-xs text-purple-600 dark:text-purple-400 font-medium">M√©decin</p>
            </div>
          </div>

          <!-- D√©connexion avec gradient -->
          <button
            (click)="logout()"
            class="px-3 py-1.5 sm:px-4 sm:py-2 text-xs sm:text-sm bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 flex-shrink-0 whitespace-nowrap"
          >
            <span class="hidden sm:inline">D√©connexion</span>
            <svg class="w-4 h-4 sm:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
    </div>
  </nav>

<!-- Tabs navigation - STICKY -->
<div class="sticky top-[60px] sm:top-[65px] z-30 bg-gradient-to-br from-indigo-50/95 via-purple-50/95 to-pink-50/95 dark:from-gray-900/95 dark:via-purple-900/20 dark:to-indigo-900/20 backdrop-blur-xl border-b border-purple-500/20">
    <div class="container mx-auto px-4 sm:px-6 py-2">
      <!-- Conteneur des tabs avec scroll horizontal sur mobile -->
      <div class="glass-tabs rounded-xl sm:rounded-2xl p-1 sm:p-2 shadow-xl backdrop-blur-xl bg-white/60 dark:bg-gray-800/60 overflow-x-auto no-scrollbar">
        <div class="inline-flex space-x-1 sm:space-x-2 min-w-max sm:min-w-0">

          <!-- Vue d'ensemble -->
          <button
            (click)="switchTab('overview')"
            [class]="activeTab === 'overview' ? 'bg-gradient-to-r from-blue-500 to-cyan-500 text-white shadow-lg scale-105' : 'hover:bg-white/50 dark:hover:bg-gray-700/50'"
            class="relative px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-base font-medium sm:font-bold transition-all duration-300 flex flex-col sm:flex-row items-center space-x-1 sm:space-x-3 group whitespace-nowrap flex-shrink-0"
          >
            <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
            </svg>
            <span class="inline sm:inline">Vue d'ensemble</span>
            <div *ngIf="activeTab === 'overview'" class="absolute inset-0 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg sm:rounded-xl blur-xl opacity-50 -z-10"></div>
          </button>

          <!-- Patients -->
          <button
            (click)="switchTab('patients')"
            [class]="activeTab === 'patients' ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg scale-105' : 'hover:bg-white/50 dark:hover:bg-gray-700/50'"
            class="relative px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-base font-medium sm:font-bold transition-all duration-300 flex flex-col sm:flex-row items-center space-x-1 sm:space-x-3 group whitespace-nowrap flex-shrink-0"
          >
            <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <span class="inline sm:inline">Patients</span>
            <div *ngIf="activeTab === 'patients'" class="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg sm:rounded-xl blur-xl opacity-50 -z-10"></div>
          </button>

          <!-- Alertes -->
          <button
            (click)="switchTab('alerts')"
            [class]="activeTab === 'alerts' ? 'bg-gradient-to-r from-yellow-500 to-orange-500 text-white shadow-lg scale-105' : 'hover:bg-white/50 dark:hover:bg-gray-700/50'"
            class="relative px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-base font-medium sm:font-bold transition-all duration-300 flex flex-col sm:flex-row items-center space-x-1 sm:space-x-3 group whitespace-nowrap flex-shrink-0"
          >
            <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            <span class="inline sm:inline">Alertes</span>
            <div *ngIf="activeTab === 'alerts'" class="absolute inset-0 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg sm:rounded-xl blur-xl opacity-50 -z-10"></div>
          </button>

          <!-- Questions -->
          <button
            (click)="switchTab('questions')"
            [class]="activeTab === 'questions' ? 'bg-gradient-to-r from-pink-500 to-rose-500 text-white shadow-lg scale-105' : 'hover:bg-white/50 dark:hover:bg-gray-700/50'"
            class="relative px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-base font-medium sm:font-bold transition-all duration-300 flex flex-col sm:flex-row items-center space-x-1 sm:space-x-3 group whitespace-nowrap flex-shrink-0"
          >
            <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            <span class="inline sm:inline">Questions</span>
            <span *ngIf="nombreQuestionsEnAttente > 0" class="absolute -top-1 -right-1 px-1.5 py-0.5 sm:px-2 sm:py-1 bg-red-500 text-white text-[10px] sm:text-xs font-bold rounded-full animate-pulse shadow-lg">
              {{ nombreQuestionsEnAttente }}
            </span>
            <div *ngIf="activeTab === 'questions'" class="absolute inset-0 bg-gradient-to-r from-pink-500 to-rose-500 rounded-lg sm:rounded-xl blur-xl opacity-50 -z-10"></div>
          </button>

          <!-- Rapports -->
          <button
            (click)="switchTab('reports')"
            [class]="activeTab === 'reports' ? 'bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg scale-105' : 'hover:bg-white/50 dark:hover:bg-gray-700/50'"
            class="relative px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-base font-medium sm:font-bold transition-all duration-300 flex flex-col sm:flex-row items-center space-x-1 sm:space-x-3 group whitespace-nowrap flex-shrink-0"
          >
            <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span class="inline sm:inline">Rapports</span>
            <div *ngIf="activeTab === 'reports'" class="absolute inset-0 bg-gradient-to-r from-green-500 to-teal-500 rounded-lg sm:rounded-xl blur-xl opacity-50 -z-10"></div>
          </button>

          <!-- Mon Profil -->
          <button
            (click)="switchTab('profile')"
            [class]="activeTab === 'profile' ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg scale-105' : 'hover:bg-white/50 dark:hover:bg-gray-700/50'"
            class="relative px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-base font-medium sm:font-bold transitionall duration-300 flex flex-col sm:flex-row items-center space-x-1 sm:space-x-3 group whitespace-nowrap flex-shrink-0"
          >
            <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span class="inline sm:inline">Profil</span>
            <div *ngIf="activeTab === 'profile'" class="absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg sm:rounded-xl blur-xl opacity-50 -z-10"></div>
          </button>

        </div>
      </div>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="container mx-auto px-4 pb-12">
    <!-- ========== ONGLET VUE D'ENSEMBLE ========== -->
    <div *ngIf="activeTab === 'overview'" class="space-y-6">
      <!-- Statistiques en cartes -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Total patients -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Total Patients</p>
              <p class="text-3xl font-bold text-gray-900 dark:text-white mt-2">
                {{ statistiques?.totalPatients || 0 }}
              </p>
            </div>
            <div class="p-4 bg-blue-500/20 rounded-xl">
              <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Patients actifs -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Actifs</p>
              <p class="text-3xl font-bold text-green-600 dark:text-green-400 mt-2">
                {{ statistiques?.patientsActifs || 0 }}
              </p>
            </div>
            <div class="p-4 bg-green-500/20 rounded-xl">
              <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Patients √† risque -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">√Ä Risque</p>
              <p class="text-3xl font-bold text-red-600 dark:text-red-400 mt-2">
                {{ statistiques?.patientsARisque || 0 }}
              </p>
            </div>
            <div class="p-4 bg-red-500/20 rounded-xl">
              <svg class="w-8 h-8 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Archiv√©s -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Archiv√©s</p>
              <p class="text-3xl font-bold text-purple-600 dark:text-purple-400 mt-2">
                {{ statistiques?.patientsArchives || 0 }}
              </p>
            </div>
            <div class="p-4 bg-purple-500/20 rounded-xl">
              <svg class="w-8 h-8 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Aper√ßu patients r√©cents -->
      <div class="glass rounded-xl p-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Patients r√©cents</h2>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Patient</th>
                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Derni√®re mesure</th>
                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Statut</th>
                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let patient of patientsAffiches.slice(0, 5)" class="border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                <td class="py-3 px-4">
                  <div class="flex items-center space-x-3">
                    <img
                      [src]="patient.photoProfil || 'https://ui-avatars.com/api/?name=' + patient.prenom + '+' + patient.nom"
                      class="w-10 h-10 rounded-full"
                      [alt]="patient.prenom + ' ' + patient.nom"
                    >
                    <div>
                      <p class="font-medium text-gray-900 dark:text-white">{{ patient.prenom }} {{ patient.nom }}</p>
                      <p class="text-sm text-gray-600 dark:text-gray-400">{{ patient.email }}</p>
                    </div>
                  </div>
                </td>
                <td class="py-3 px-4">
                  <p class="text-sm text-gray-900 dark:text-white">
                    {{ patient.derniereMesure ? formatDate(patient.derniereMesure.horodatageMesure) : 'Aucune' }}
                  </p>
                </td>
                <td class="py-3 px-4">
                  <span
                    *ngIf="patient.derniereMesure"
                    [class]="getStatusBg(patient.derniereMesure.statut)"
                    class="px-3 py-1 rounded-full text-sm font-medium"
                    [class.text-green-700]="patient.derniereMesure.statut === 'NORMAL'"
                    [class.text-yellow-700]="patient.derniereMesure.statut === 'ATTENTION'"
                    [class.text-red-700]="patient.derniereMesure.statut === 'DANGER'"
                  >
                    {{ patient.derniereMesure.statut }}
                  </span>
                  <span *ngIf="!patient.derniereMesure" class="text-sm text-gray-500">-</span>
                </td>
                <td class="py-3 px-4">
                  <button
                    (click)="voirDetailsPatient(patient)"
                    class="group relative px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center space-x-2"
                  >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    <span>Voir</span>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ========== ONGLET PATIENTS ========== -->
    <div *ngIf="activeTab === 'patients'" class="space-y-6">
      <!-- Barre de recherche et filtres -->
      <div class="glass rounded-xl p-6">
        <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
          <!-- Recherche -->
          <div class="flex-1 w-full lg:w-auto">
            <div class="relative">
              <input
                type="text"
                [(ngModel)]="searchQuery"
                (ngModelChange)="onSearchChange()"
                placeholder="Rechercher un patient..."
                class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
              >
              <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>

          <!-- Filtres -->
          <div class="flex gap-2 flex-wrap">
            <button
              *ngFor="let filter of [
                { id: 'all', label: 'Tous', color: 'blue' },
                { id: 'normal', label: 'Normal', color: 'green' },
                { id: 'attention', label: 'Attention', color: 'yellow' },
                { id: 'danger', label: 'Danger', color: 'red' }
              ]"
              (click)="setFilterStatus(filter.id)"
              [class.bg-blue-500]="filterStatus === filter.id && filter.color === 'blue'"
              [class.bg-green-500]="filterStatus === filter.id && filter.color === 'green'"
              [class.bg-yellow-500]="filterStatus === filter.id && filter.color === 'yellow'"
              [class.bg-red-500]="filterStatus === filter.id && filter.color === 'red'"
              [class.text-white]="filterStatus === filter.id"
              class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
            >
              {{ filter.label }}
            </button>

            <!-- Toggle archiv√©s -->
            <button
              (click)="toggleArchived()"
              [class.bg-purple-500]="showArchived"
              [class.text-white]="showArchived"
              class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all flex items-center space-x-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
              </svg>
              <span>{{ showArchived ? 'Masquer' : 'Afficher' }} archiv√©s</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Liste des patients -->
      <div *ngIf="loadingPatients" class="glass rounded-xl p-12 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
        <p class="mt-4 text-gray-600 dark:text-gray-400">Chargement des patients...</p>
      </div>

      <div *ngIf="!loadingPatients && patientsAffiches.length === 0" class="glass rounded-xl p-12 text-center">
        <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Aucun patient trouv√©</h3>
        <p class="text-gray-600 dark:text-gray-400">Modifiez vos filtres ou votre recherche</p>
      </div>

      <div *ngIf="!loadingPatients && patientsAffiches.length > 0" class="space-y-6">
        <!-- Grille patients -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div *ngFor="let patient of patientsPagees" class="glass rounded-xl p-6 hover:shadow-xl transition-all">
            <!-- Header carte patient -->
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center space-x-4">
                <img
                  [src]="patient.photoProfil || 'https://ui-avatars.com/api/?name=' + patient.prenom + '+' + patient.nom"
                  class="w-16 h-16 rounded-full border-2 border-blue-500"
                  [alt]="patient.prenom + ' ' + patient.nom"
                >
                <div>
                  <h3 class="text-lg font-bold text-gray-900 dark:text-white">
                    {{ patient.prenom }} {{ patient.nom }}
                  </h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ patient.email }}</p>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    üì± {{ patient.telephone || 'Non renseign√©' }}
                  </p>
                  <p *ngIf="patient.idDispositif" class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                    üìü {{ patient.idDispositif }}
                  </p>
                </div>
              </div>
              <!-- Badge archiv√© -->
              <span
                *ngIf="patient.estArchive"
                class="px-3 py-1 bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-400 rounded-full text-sm font-medium"
              >
                Archiv√©
              </span>
            </div>

            <!-- Infos patient -->
            <div class="space-y-2 mb-4">
              <div *ngIf="patient.derniereMesure" class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Derni√®re mesure:</span>
                <span class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ formatDate(patient.derniereMesure.horodatageMesure) }}
                </span>
              </div>

              <div *ngIf="patient.derniereMesure" class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">BPM / SpO2:</span>
                <span class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ patient.derniereMesure.bpm }} / {{ patient.derniereMesure.spo2 }}%
                </span>
              </div>

              <div *ngIf="patient.derniereMesure" class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Statut:</span>
                <span
                  [class]="getStatusBg(patient.derniereMesure.statut)"
                  class="px-3 py-1 rounded-full text-xs font-medium"
                  [class.text-green-700]="patient.derniereMesure.statut === 'NORMAL'"
                  [class.text-yellow-700]="patient.derniereMesure.statut === 'ATTENTION'"
                  [class.text-red-700]="patient.derniereMesure.statut === 'DANGER'"
                >
                  {{ patient.derniereMesure.statut }}
                </span>
              </div>

              <div *ngIf="patient.estArchive" class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Raison:</span>
                <span class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ getRaisonLabel(patient.raisonArchivage) }}
                </span>
              </div>

              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600 dark:text-gray-400">Mesures:</span>
                <span class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ patient.nombreMesures || 0 }}
                </span>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-2">
              <button
                (click)="voirDetailsPatient(patient)"
                class="flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all font-medium"
              >
                Voir d√©tails
              </button>

              <button
                (click)="exportRapportPatient(patient)"
                [disabled]="exportingPDF"
                class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all"
                title="Rapport PDF"
              >
                <svg *ngIf="!exportingPDF" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
                <svg *ngIf="exportingPDF" class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </button>

              <button
                *ngIf="!patient.estArchive"
                (click)="openArchiveModal(patient)"
                class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-all"
                title="Archiver"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                </svg>
              </button>

              <button
                *ngIf="patient.estArchive"
                (click)="desarchiverPatient(patient)"
                class="px-4 py-2 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white rounded-lg transition-all font-medium shadow-lg hover:shadow-xl transform hover:scale-105"
                title="D√©sarchiver"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination fixe -->
      <div class="glass rounded-xl p-6 sticky bottom-6 shadow-2xl border-2 border-purple-500/30">
        <div class="flex items-center justify-between">
          <!-- Info pagination -->
          <div class="text-sm text-gray-600 dark:text-gray-400">
            Page <span class="font-bold text-purple-600 dark:text-purple-400">{{ currentPage }}</span>
            sur <span class="font-bold">{{ totalPages }}</span>
            <span class="ml-4">
              ({{ patientsAffiches.length }} patient{{ patientsAffiches.length > 1 ? 's' : '' }})
            </span>
          </div>

          <!-- Boutons pagination -->
          <div class="flex items-center space-x-2">
            <!-- Pr√©c√©dent -->
            <button
              (click)="previousPage()"
              [disabled]="currentPage === 1"
              class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>

            <!-- Num√©ros de page -->
            <div class="flex space-x-1">
              <button
                *ngFor="let page of pageNumbers"
                (click)="goToPage(page)"
                [class.bg-gradient-to-r]="currentPage === page"
                [class.from-blue-500]="currentPage === page"
                [class.to-purple-600]="currentPage === page"
                [class.text-white]="currentPage === page"
                [class.shadow-lg]="currentPage === page"
                [class.scale-110]="currentPage === page"
                class="w-10 h-10 rounded-lg font-bold hover:bg-gray-200 dark:hover:bg-gray-700 transition-all transform hover:scale-105"
              >
                {{ page }}
              </button>
            </div>

            <!-- Suivant -->
            <button
              (click)="nextPage()"
              [disabled]="currentPage === totalPages"
              class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:from-blue-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== ONGLET ALERTES ========== -->
    <div *ngIf="activeTab === 'alerts'" class="space-y-6">
      <!-- Statistiques alertes -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Total actives -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all border-2 border-red-500/30">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Alertes actives</p>
              <p class="text-4xl font-bold text-red-600 dark:text-red-400 mt-2">
                {{ statsAlertes?.actives || 0 }}
              </p>
            </div>
            <div class="p-4 bg-red-500/20 rounded-xl animate-pulse">
              <svg class="w-8 h-8 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Critiques -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all border-2 border-red-600/30">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Critiques</p>
              <p class="text-4xl font-bold text-red-700 dark:text-red-500 mt-2">
                {{ statsAlertes?.critiques || 0 }}
              </p>
            </div>
            <div class="p-4 bg-red-600/20 rounded-xl">
              <svg class="w-8 h-8 text-red-700 dark:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18a3.75 3.75 0 00.495-7.467 5.99 5.99 0 00-1.925 3.546 5.974 5.974 0 01-2.133-1A3.75 3.75 0 0012 18z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Danger -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all border-2 border-orange-500/30">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Danger</p>
              <p class="text-4xl font-bold text-orange-600 dark:text-orange-400 mt-2">
                {{ statsAlertes?.danger || 0 }}
              </p>
            </div>
            <div class="p-4 bg-orange-500/20 rounded-xl">
              <svg class="w-8 h-8 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Acquitt√©es -->
        <div class="glass rounded-xl p-6 hover:shadow-xl transition-all border-2 border-green-500/30">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-gray-600 dark:text-gray-400">Acquitt√©es</p>
              <p class="text-4xl font-bold text-green-600 dark:text-green-400 mt-2">
                {{ statsAlertes?.acquittees || 0 }}
              </p>
            </div>
            <div class="p-4 bg-green-500/20 rounded-xl">
              <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtres et actions -->
      <div class="glass rounded-xl p-6">
        <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
          <!-- Filtres statut -->
          <div class="flex gap-2 flex-wrap">
            <button
              *ngFor="let filtre of [
                { id: 'actives', label: 'Actives', color: 'red' },
                { id: 'acquittees', label: 'Acquitt√©es', color: 'green' },
                { id: 'toutes', label: 'Toutes', color: 'blue' }
              ]"
              (click)="setFilterAlertes(filtre.id, filterAlerteType)"
              [class.bg-red-500]="filterAlerteStatut === filtre.id && filtre.color === 'red'"
              [class.bg-green-500]="filterAlerteStatut === filtre.id && filtre.color === 'green'"
              [class.bg-blue-500]="filterAlerteStatut === filtre.id && filtre.color === 'blue'"
              [class.text-white]="filterAlerteStatut === filtre.id"
              class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all font-medium"
            >
              {{ filtre.label }}
            </button>
          </div>

          <!-- Filtres type -->
          <div class="flex gap-2 flex-wrap">
            <button
              *ngFor="let type of [
                { id: 'toutes', label: 'Tous types' },
                { id: 'critique', label: 'Critique' },
                { id: 'danger', label: 'Danger' },
                { id: 'avertissement', label: 'Avertissement' }
              ]"
              (click)="setFilterAlertes(filterAlerteStatut, type.id)"
              [class.bg-purple-500]="filterAlerteType === type.id"
              [class.text-white]="filterAlerteType === type.id"
              class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all font-medium"
            >
              {{ type.label }}
            </button>
          </div>

          <!-- Actions masse -->
          <div class="flex gap-2">
            <button
              (click)="selectAllAlertes()"
              class="px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all font-medium"
            >
              {{ selectedAlertes.length === alertes.length ? 'Tout d√©s√©lectionner' : 'Tout s√©lectionner' }}
            </button>

            <button
              *ngIf="selectedAlertes.length > 0"
              (click)="acquitterSelection()"
              class="px-6 py-2 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white rounded-lg font-bold transition-all shadow-lg hover:shadow-xl transform hover:scale-105"
            >
              ‚úì Acquitter ({{ selectedAlertes.length }})
            </button>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loadingAlertes" class="glass rounded-xl p-12 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div>
        <p class="mt-4 text-gray-600 dark:text-gray-400">Chargement des alertes...</p>
      </div>

      <!-- Aucune alerte -->
      <div *ngIf="!loadingAlertes && alertes.length === 0" class="glass rounded-xl p-12 text-center">
        <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Aucune alerte</h3>
        <p class="text-gray-600 dark:text-gray-400">Tous vos patients sont en s√©curit√© ! üéâ</p>
      </div>

      <!-- Liste des alertes -->
      <div *ngIf="!loadingAlertes && alertes.length > 0" class="space-y-4">
        <div
          *ngFor="let alerte of alertesPaginees"
          [class]="getAlerteBg(alerte.type)"
          class="glass rounded-xl p-6 border-2 transition-all hover:shadow-xl"
        >
          <div class="flex items-start gap-4">
            <!-- Checkbox -->
            <div *ngIf="!alerte.estAcquittee" class="flex items-center pt-1">
              <input
                type="checkbox"
                [checked]="selectedAlertes.includes(alerte._id)"
                (change)="toggleSelectAlerte(alerte._id)"
                class="w-5 h-5 rounded border-gray-300 text-purple-600 focus:ring-purple-500"
              >
            </div>

            <!-- Ic√¥ne gravit√© -->
            <div class="flex-shrink-0">
              <div [class]="'p-3 rounded-xl ' + (alerte.type === 'critique' ? 'bg-red-600/20' : alerte.type === 'danger' ? 'bg-orange-600/20' : 'bg-yellow-600/20')">
                <svg class="w-8 h-8" [class]="getAlerteColor(alerte.type)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
              </div>
            </div>

            <!-- Contenu -->
            <div class="flex-1">
              <div class="flex items-start justify-between mb-2">
                <div>
                  <div class="flex items-center space-x-2 mb-1">
                    <span [class]="'px-3 py-1 rounded-full text-xs font-bold uppercase ' + getAlerteBg(alerte.type)">
                      {{ alerte.type }}
                    </span>
                    <span class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-full text-xs font-medium">
                      {{ alerte.parametre.toUpperCase() }}
                    </span>
                  </div>
                  <h4 class="text-lg font-bold text-gray-900 dark:text-white">
                    {{ alerte.idUtilisateur?.prenom }} {{ alerte.idUtilisateur?.nom }}
                  </h4>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    {{ alerte.idUtilisateur?.email }}
                  </p>
                </div>

                <!-- Badge acquitt√©e -->
                <span
                  *ngIf="alerte.estAcquittee"
                  class="px-3 py-1 bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400 rounded-full text-xs font-medium"
                >
                  ‚úì Acquitt√©e
                </span>
              </div>

              <p class="text-gray-900 dark:text-white font-medium mb-3">
                {{ alerte.message }}
              </p>

              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400">
                  <span>
                    üìä Valeur: <strong class="font-bold text-gray-900 dark:text-white">{{ alerte.valeur }}</strong>
                  </span>
                  <span>
                    üéØ Seuil: <strong class="font-bold">{{ alerte.seuil }}</strong>
                  </span>
                  <span>
                    üïê {{ formatDate(alerte.horodatage) }}
                  </span>
                </div>

                <!-- Actions -->
                <div class="flex items-center space-x-2">
                  <button
                    *ngIf="!alerte.estAcquittee"
                    (click)="acquitterAlerte(alerte)"
                    class="px-4 py-2 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl transform hover:scale-105"
                  >
                    ‚úì Acquitter
                  </button>

                  <button
                    (click)="voirDetailsPatient(alerte.idUtilisateur)"
                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all shadow-lg hover:shadow-xl transform hover:scale-105"
                  >
                    üë§ Voir patient
                  </button>
                </div>
              </div>

              <!-- Info acquittement -->
              <div *ngIf="alerte.estAcquittee && alerte.acquitteePar" class="mt-3 pt-3 border-t border-gray-300 dark:border-gray-600">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  Acquitt√©e par <strong>Dr. {{ alerte.acquitteePar.prenom }} {{ alerte.acquitteePar.nom }}</strong>
                  le {{ formatDate(alerte.dateAcquittement) }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="nombrePagesAlertes > 1" class="glass rounded-xl p-6 mt-6">
        <div class="flex items-center justify-between">
          <!-- Info -->
          <div class="text-sm text-gray-600 dark:text-gray-400">
            Affichage <strong>{{ (pageAlerteActuelle - 1) * alertesParPage + 1 }}</strong>
            √† <strong>{{ Math.min(pageAlerteActuelle * alertesParPage, alertes.length) }}</strong>
            sur <strong>{{ alertes.length }}</strong> alertes
          </div>

          <!-- Boutons pagination -->
          <div class="flex items-center space-x-2">
            <!-- Pr√©c√©dent -->
            <button
              (click)="pagePrecedenteAlerte()"
              [disabled]="pageAlerteActuelle === 1"
              class="px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
            >
              ‚Üê Pr√©c√©dent
            </button>

            <!-- Num√©ros de page -->
            <div class="hidden md:flex space-x-1">
              <button
                *ngFor="let page of pagesAlertes"
                (click)="changerPageAlerte(page)"
                [class.bg-blue-500]="pageAlerteActuelle === page"
                [class.text-white]="pageAlerteActuelle === page"
                [class.border-blue-500]="pageAlerteActuelle === page"
                class="w-10 h-10 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-bold hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
              >
                {{ page }}
              </button>
            </div>

            <!-- Page actuelle (mobile) -->
            <div class="md:hidden px-4 py-2 bg-blue-500 text-white rounded-lg font-bold">
              {{ pageAlerteActuelle }} / {{ nombrePagesAlertes }}
            </div>

            <!-- Suivant -->
            <button
              (click)="pageSuivanteAlerte()"
              [disabled]="pageAlerteActuelle === nombrePagesAlertes"
              class="px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
            >
              Suivant ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

        <!-- ========== ONGLET QUESTIONS ========== -->
    <div *ngIf="activeTab === 'questions'" class="space-y-6">
      
      <!-- Header -->
      <div class="glass rounded-2xl p-6 border-2 border-purple-500/30">
        <div class="flex items-center space-x-4">
          <div class="p-4 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
          </div>
          <div>
            <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent">
              Questions des patients
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mt-1">
              R√©pondez aux questions de vos patients
            </p>
          </div>
        </div>
      </div>

      <!-- Filtres -->
      <div class="glass rounded-xl p-6">
        <div class="flex gap-2 flex-wrap">
          <button
            (click)="filterQuestionStatut = 'en_attente'"
            [class.bg-orange-500]="filterQuestionStatut === 'en_attente'"
            [class.text-white]="filterQuestionStatut === 'en_attente'"
            class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all font-medium"
          >
            ‚è≥ En attente ({{ nombreQuestionsEnAttente }})
          </button>
          <button
            (click)="filterQuestionStatut = 'repondu'"
            [class.bg-green-500]="filterQuestionStatut === 'repondu'"
            [class.text-white]="filterQuestionStatut === 'repondu'"
            class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all font-medium"
          >
            ‚úÖ R√©pondues ({{ nombreQuestionsRepondues }})
          </button>
          <button
            (click)="filterQuestionStatut = 'toutes'"
            [class.bg-blue-500]="filterQuestionStatut === 'toutes'"
            [class.text-white]="filterQuestionStatut === 'toutes'"
            class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all font-medium"
          >
            üìã Toutes ({{ questionsRecues.length }})
          </button>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loadingQuestions" class="glass rounded-2xl p-12 text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
        <p class="mt-4 text-gray-600 dark:text-gray-400">Chargement des questions...</p>
      </div>

      <!-- Aucune question -->
      <div *ngIf="!loadingQuestions && questionsFiltrees.length === 0" class="glass rounded-2xl p-12 text-center">
        <svg class="w-20 h-20 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Aucune question</h3>
        <p class="text-gray-600 dark:text-gray-400">
          {{ filterQuestionStatut === 'en_attente' ? 'Toutes les questions ont √©t√© trait√©es !' : 'Aucune question dans cette cat√©gorie' }}
        </p>
      </div>

      <!-- Liste des questions -->
      <div *ngIf="!loadingQuestions && questionsPaginees.length > 0" class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div
          *ngFor="let question of questionsPaginees"
          class="glass rounded-xl p-4 border-2 transition-all hover:shadow-xl cursor-pointer"
          [class]="getQuestionBg(question.statut)"
        >
          <!-- Patient + Statut -->
          <div class="flex items-center space-x-3 mb-3">
            <img
              [src]="question.patientId?.photoProfil || 'https://ui-avatars.com/api/?name=' + question.patientId?.prenom + '+' + question.patientId?.nom"
              class="w-10 h-10 rounded-full border-2 border-purple-500"
              [alt]="question.patientId?.prenom + ' ' + question.patientId?.nom"
            >
            <div class="flex-1 min-w-0">
              <h4 class="text-sm font-bold text-gray-900 dark:text-white truncate">
                {{ question.patientId?.prenom }} {{ question.patientId?.nom }}
              </h4>
              <p class="text-xs text-gray-600 dark:text-gray-400 truncate">
                {{ question.patientId?.email }}
              </p>
            </div>
            <span class="text-2xl">{{ getQuestionIcon(question.statut) }}</span>
          </div>

          <!-- Note concern√©e (compacte) -->
          <div class="p-2 bg-white dark:bg-gray-800 rounded-lg mb-3">
            <p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">Note :</p>
            <p class="text-xs text-gray-900 dark:text-white line-clamp-2">
              {{ question.noteId?.contenu }}
            </p>
          </div>

          <!-- Question -->
          <div class="mb-3">
            <p class="text-xs font-bold text-gray-600 dark:text-gray-400 mb-1">Question :</p>
            <p class="text-sm text-gray-900 dark:text-white line-clamp-3">
              {{ question.question }}
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              {{ formatDate(question.createdAt) }}
            </p>
          </div>

          <!-- R√©ponse existante (compacte) -->
          <div *ngIf="question.statut === 'repondu'" class="p-2 bg-green-50 dark:bg-green-900/20 rounded-lg mb-3">
            <p class="text-xs font-bold text-green-600 dark:text-green-400 mb-1">R√©ponse :</p>
            <p class="text-xs text-gray-900 dark:text-white line-clamp-2">
              {{ question.reponse }}
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              {{ formatDate(question.dateReponse) }}
            </p>
          </div>

          <!-- Actions -->
          <button
            (click)="openReponseModal(question)"
            class="w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-lg font-bold transition-all shadow-lg hover:shadow-xl text-sm"
          >
            {{ question.statut === 'en_attente' ? '‚úçÔ∏è R√©pondre' : '‚úèÔ∏è Modifier' }}
          </button>
        </div>
      </div>

      <!-- Pagination questions -->
      <div *ngIf="nombrePagesQuestions > 1" class="glass rounded-2xl p-6 mt-6 border-2 border-purple-500/30">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
          <!-- Info -->
          <div class="text-sm text-gray-600 dark:text-gray-400">
            Affichage <strong>{{ (pageQuestionActuelle - 1) * questionsParPage + 1 }}</strong> 
            √† <strong>{{ Math.min(pageQuestionActuelle * questionsParPage, questionsFiltrees.length) }}</strong> 
            sur <strong>{{ questionsFiltrees.length }}</strong> questions
          </div>

          <!-- Boutons pagination -->
          <div class="flex items-center space-x-2">
            <!-- Pr√©c√©dent -->
            <button
              (click)="pagePrecedenteQuestion()"
              [disabled]="pageQuestionActuelle === 1"
              class="px-4 py-2 bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-purple-50 dark:hover:bg-gray-600 transition-all"
            >
              ‚Üê Pr√©c√©dent
            </button>

            <!-- Num√©ros de page -->
            <div class="hidden md:flex space-x-1">
              <button
                *ngFor="let page of pagesQuestions"
                (click)="changerPageQuestion(page)"
                [class.bg-purple-500]="pageQuestionActuelle === page"
                [class.text-white]="pageQuestionActuelle === page"
                [class.border-purple-500]="pageQuestionActuelle === page"
                class="w-10 h-10 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-bold hover:bg-purple-50 dark:hover:bg-gray-600 transition-all"
              >
                {{ page }}
              </button>
            </div>

            <!-- Page actuelle (mobile) -->
            <div class="md:hidden px-4 py-2 bg-purple-500 text-white rounded-lg font-bold">
              {{ pageQuestionActuelle }} / {{ nombrePagesQuestions }}
            </div>

            <!-- Suivant -->
            <button
              (click)="pageSuivanteQuestion()"
              [disabled]="pageQuestionActuelle === nombrePagesQuestions"
              class="px-4 py-2 bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-purple-50 dark:hover:bg-gray-600 transition-all"
            >
              Suivant ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== ONGLET RAPPORTS ========== -->
    <!-- ========== ONGLET RAPPORTS OPTIMIS√â ========== -->
    <div *ngIf="activeTab === 'reports'" class="space-y-6">
      
      <!-- En-t√™te -->
      <div class="glass rounded-2xl p-6 border-2 border-purple-500/30">
        <div class="flex items-center space-x-4">
          <div class="p-4 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </div>
          <div>
            <h2 class="text-3xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent">
              Rapports & Analyses
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mt-1">
              G√©n√©rez des rapports personnalis√©s et exportez vos donn√©es
            </p>
          </div>
        </div>
      </div>

      <!-- Cartes actions -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <!-- Export CSV Global -->
        <div class="glass rounded-2xl p-8 hover:shadow-2xl transition-all border-2 border-green-500/30 group relative overflow-hidden">
          <!-- Effet de fond anim√© -->
          <div class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-teal-500/5 group-hover:from-green-500/10 group-hover:to-teal-500/10 transition-all"></div>
          
          <div class="relative">
            <div class="flex items-center justify-between mb-6">
              <div class="p-4 bg-green-500/20 rounded-2xl group-hover:scale-110 transition-transform">
                <svg class="w-12 h-12 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
              <span class="px-4 py-2 bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400 rounded-full text-sm font-bold">
                ‚úÖ Disponible
              </span>
            </div>
            
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">
              Export CSV Global
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6">
              Exportez toutes les mesures de vos patients au format CSV compatible Excel
            </p>
            
            <ul class="space-y-3 mb-6">
              <li class="flex items-center text-gray-700 dark:text-gray-300">
                <svg class="w-5 h-5 text-green-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Toutes les donn√©es patients</span>
              </li>
              <li class="flex items-center text-gray-700 dark:text-gray-300">
                <svg class="w-5 h-5 text-green-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Format Excel/LibreOffice</span>
              </li>
              <li class="flex items-center text-gray-700 dark:text-gray-300">
                <svg class="w-5 h-5 text-green-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Analyse statistique facilit√©e</span>
              </li>
            </ul>
            
            <button
              (click)="exportCSVGlobal()"
              [disabled]="exportingCSV"
              class="w-full px-6 py-4 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 disabled:opacity-50 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-2xl transform hover:scale-105 flex items-center justify-center text-lg"
            >
              <span *ngIf="!exportingCSV" class="flex items-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Exporter CSV
              </span>
              <span *ngIf="exportingCSV" class="flex items-center">
                <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Export en cours...
              </span>
            </button>
          </div>
        </div>

        <!-- Comparaison Patients - Bient√¥t -->
        <div class="glass rounded-2xl p-8 hover:shadow-2xl transition-all border-2 border-purple-500/30 group relative overflow-hidden">
          <!-- Badge "Bient√¥t" -->
          <!-- <div class="absolute top-4 right-4 px-4 py-2 bg-purple-500/20 backdrop-blur-xl border-2 border-purple-500/50 rounded-full text-purple-700 dark:text-purple-400 text-sm font-bold">
            üöß Bient√¥t disponible
          </div> -->
          
          <div class="relative">
            <div class="flex items-center justify-between mb-6">
              <div class="p-4 bg-purple-500/20 rounded-2xl">
                <svg class="w-12 h-12 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              </div>
            </div>
            
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-3">
              Comparaison Multi-Patients
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-6">
              Comparez jusqu'√† 5 patients simultan√©ment avec graphiques interactifs
            </p>
            
            <ul class="space-y-3 mb-6">
              <li class="flex items-center text-gray-700 dark:text-gray-300">
                <svg class="w-5 h-5 text-purple-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Analyse de cohorte</span>
              </li>
              <li class="flex items-center text-gray-700 dark:text-gray-300">
                <svg class="w-5 h-5 text-purple-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Graphiques comparatifs</span>
              </li>
              <li class="flex items-center text-gray-700 dark:text-gray-300">
                <svg class="w-5 h-5 text-purple-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Export rapport comparatif</span>
              </li>
            </ul>
            
            <button
              (click)="openComparaisonModal()"
              class="w-full px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-2xl transform hover:scale-105 text-lg"
            >
              <span class="flex items-center justify-center">
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Comparer patients
              </span>
            </button>
          </div>
        </div>
      </div>

      <!-- Info rapports PDF patients -->
      <div class="glass rounded-xl p-6 border-2 border-blue-500/30">
        <div class="flex items-start space-x-4">
          <div class="p-3 bg-blue-500/20 rounded-xl flex-shrink-0">
            <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <div>
            <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-2">
              üí° Astuce : Rapports PDF individuels
            </h4>
            <p class="text-gray-600 dark:text-gray-400">
              Pour g√©n√©rer le rapport PDF d'un patient, rendez-vous dans l'onglet <strong>Patients</strong> 
              et cliquez sur le bouton <span class="px-2 py-1 bg-red-500 text-white rounded text-sm">üìÑ PDF</span> 
              sur la carte du patient concern√©.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== ONGLET PROFIL ========== -->
    <div *ngIf="activeTab === 'profile'" class="space-y-6">
      
      <!-- Carte profil -->
      <div class="glass rounded-2xl p-8">
        <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-6">
          Mon Profil M√©decin
        </h2>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
          <!-- Photo de profil -->
          <div class="lg:col-span-1">
            <div class="text-center">
              <div class="relative inline-block mb-4">
                <div class="absolute inset-0 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full blur-xl opacity-50"></div>
                <img
                  [src]="user?.photoProfil || 'https://ui-avatars.com/api/?name=' + (user?.prenom || 'M') + '+' + (user?.nom || 'D') + '&background=8B5CF6&color=fff&size=200'"
                  class="relative w-40 h-40 rounded-full border-4 border-purple-500 shadow-2xl mx-auto"
                  [alt]="user?.prenom + ' ' + user?.nom"
                >
              </div>
              
              <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-1">
                Dr. {{ user?.prenom }} {{ user?.nom }}
              </h3>
              <p class="text-purple-600 dark:text-purple-400 font-medium mb-4">M√©decin</p>
              
              <!-- Upload photo -->
              <label class="cursor-pointer inline-block">
                <input
                  type="file"
                  accept="image/*"
                  (change)="uploadPhoto($event)"
                  class="hidden"
                >
                <span class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg inline-flex items-center space-x-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span>Changer la photo</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Informations personnelles -->
          <div class="lg:col-span-2">
            <form (ngSubmit)="saveProfile()" class="space-y-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Pr√©nom -->
                <div>
                  <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                    Pr√©nom
                  </label>
                  <input
                    type="text"
                    [(ngModel)]="profileForm.prenom"
                    name="prenom"
                    required
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                  >
                </div>

                <!-- Nom -->
                <div>
                  <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                    Nom
                  </label>
                  <input
                    type="text"
                    [(ngModel)]="profileForm.nom"
                    name="nom"
                    required
                    class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                  >
                </div>
              </div>

              <!-- Email -->
              <div>
                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                  Email
                </label>
                <input
                  type="email"
                  [(ngModel)]="profileForm.email"
                  name="email"
                  required
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                >
              </div>

              <!-- T√©l√©phone -->
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">T√©l√©phone</label>
                <input 
                  type="tel" 
                  name="telephone"
                  [(ngModel)]="profileForm.telephone"
                  placeholder="+221 XX XXX XX XX"
                  class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <!-- Genre & Date de naissance -->
              <div>
                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Genre</label>
                <select
                  [(ngModel)]="profileForm.genre"
                  name="genre"
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                >
                  <option value="homme">üë® Homme</option>
                  <option value="femme">üë© Femme</option>
                  <option value="autre">‚ößÔ∏è Autre</option>
                </select>
              </div>

              <div>
                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Date de naissance</label>
                <input 
                  type="date" 
                  [(ngModel)]="profileForm.dateDeNaissance"
                  name="dateDeNaissance"
                  class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                />
              </div>


              <!-- Bouton sauvegarder -->
              <button
                type="submit"
                [disabled]="savingProfile"
                class="w-full px-6 py-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 disabled:opacity-50 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02]"
              >
                <span *ngIf="!savingProfile">üíæ Enregistrer les modifications</span>
                <span *ngIf="savingProfile" class="flex items-center justify-center">
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Sauvegarde...
                </span>
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Changer mot de passe -->
      <div class="glass rounded-2xl p-8">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center space-x-2">
          <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          <span>Changer le mot de passe</span>
        </h3>

        <form (ngSubmit)="changePassword()" class="space-y-6 max-w-2xl">
          
          <!-- Mot de passe actuel -->
          <div>
            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
              Mot de passe actuel
            </label>
            <input
              type="password"
              [(ngModel)]="passwordForm.currentPassword"
              name="currentPassword"
              required
              class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            >
          </div>

          <!-- Nouveau mot de passe -->
          <div>
            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
              Nouveau mot de passe
            </label>
            <input
              type="password"
              [(ngModel)]="passwordForm.newPassword"
              name="newPassword"
              required
              minlength="6"
              class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            >
          </div>

          <!-- Confirmer mot de passe -->
          <div>
            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
              Confirmer le nouveau mot de passe
            </label>
            <input
              type="password"
              [(ngModel)]="passwordForm.confirmPassword"
              name="confirmPassword"
              required
              class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
            >
          </div>

          <!-- Bouton -->
          <button
            type="submit"
            [disabled]="changingPassword"
            class="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 disabled:opacity-50 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl transform hover:scale-105"
          >
            <span *ngIf="!changingPassword">üîê Modifier le mot de passe</span>
            <span *ngIf="changingPassword" class="flex items-center">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Modification...
            </span>
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- ========== MODAL ARCHIVAGE ========== -->
  <div
    *ngIf="showArchiveModal"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
    (click)="closeArchiveModal()"
  >
    <div
      class="glass rounded-2xl p-8 max-w-md w-full"
      (click)="$event.stopPropagation()"
    >
      <!-- Header modal -->
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Archiver le patient</h3>
        <button
          (click)="closeArchiveModal()"
          class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
        >
          <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Infos patient -->
      <div *ngIf="patientAArchiver" class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
        <div class="flex items-center space-x-3">
          <img
            [src]="patientAArchiver.photoProfil || 'https://ui-avatars.com/api/?name=' + patientAArchiver.prenom + '+' + patientAArchiver.nom"
            class="w-12 h-12 rounded-full"
            [alt]="patientAArchiver.prenom + ' ' + patientAArchiver.nom"
          >
          <div>
            <p class="font-semibold text-gray-900 dark:text-white">
              {{ patientAArchiver.prenom }} {{ patientAArchiver.nom }}
            </p>
            <p class="text-sm text-gray-600 dark:text-gray-400">{{ patientAArchiver.email }}</p>
          </div>
        </div>
      </div>

      <!-- Formulaire -->
      <form (ngSubmit)="confirmArchive()" class="space-y-4">
        <!-- Raison -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Raison de l'archivage *
          </label>
          <select
            [(ngModel)]="archiveForm.raison"
            name="raison"
            required
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
          >
            <option value="gueri">Gu√©ri</option>
            <option value="transfere">Transf√©r√©</option>
            <option value="decede">D√©c√©d√©</option>
            <option value="traitement_termine">Traitement termin√©</option>
            <option value="inactif">Inactif</option>
            <option value="autre">Autre</option>
          </select>
        </div>

        <!-- Commentaire -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Commentaire (optionnel)
          </label>
          <textarea
            [(ngModel)]="archiveForm.commentaire"
            name="commentaire"
            rows="3"
            maxlength="500"
            placeholder="Ajoutez des d√©tails si n√©cessaire..."
            class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500"
          ></textarea>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            {{ archiveForm.commentaire.length }}/500 caract√®res
          </p>
        </div>

        <!-- Avertissement -->
        <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
          <div class="flex items-start space-x-3">
            <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            <div>
              <p class="text-sm font-medium text-yellow-800 dark:text-yellow-300">Attention</p>
              <p class="text-xs text-yellow-700 dark:text-yellow-400 mt-1">
                Le patient sera archiv√© et retir√© de la liste active. Vous pourrez le d√©sarchiver √† tout moment.
              </p>
            </div>
          </div>
        </div>

        <!-- Boutons -->
        <div class="flex gap-3 pt-4">
          <button
            type="button"
            (click)="closeArchiveModal()"
            class="flex-1 px-6 py-3 border border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
          >
            Annuler
          </button>
          <button
            type="submit"
            [disabled]="archiving"
            class="flex-1 px-6 py-3 bg-purple-500 hover:bg-purple-600 disabled:bg-gray-400 text-white rounded-lg font-medium transition-all flex items-center justify-center"
          >
            <span *ngIf="!archiving">Archiver</span>
            <span *ngIf="archiving" class="flex items-center">
              <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Archivage...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ========== MODAL D√âSARCHIVAGE PROFESSIONNEL ========== -->
  <div
    *ngIf="showDesarchiveModal"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
    (click)="closeDesarchiveModal()"
  >
    <div
      class="glass rounded-2xl p-8 max-w-md w-full border-2 border-green-500/30"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
          <div class="p-3 bg-green-500/20 rounded-xl">
            <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent">
            R√©activer le patient
          </h3>
        </div>
        <button
          (click)="closeDesarchiveModal()"
          class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
        >
          <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Patient info -->
      <div *ngIf="patientADesarchiver" class="mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border-2 border-green-500/30">
        <div class="flex items-center space-x-3">
          <img
            [src]="patientADesarchiver.photoProfil || 'https://ui-avatars.com/api/?name=' + patientADesarchiver.prenom + '+' + patientADesarchiver.nom"
            class="w-14 h-14 rounded-full border-2 border-green-500"
            [alt]="patientADesarchiver.prenom + ' ' + patientADesarchiver.nom"
          >
          <div>
            <p class="font-bold text-gray-900 dark:text-white text-lg">
              {{ patientADesarchiver.prenom }} {{ patientADesarchiver.nom }}
            </p>
            <p class="text-sm text-gray-600 dark:text-gray-400">{{ patientADesarchiver.email }}</p>
            <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">
              Archiv√© : {{ getRaisonLabel(patientADesarchiver.raisonArchivage) }}
            </p>
          </div>
        </div>
      </div>

      <!-- Message -->
      <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-500/30">
        <div class="flex items-start space-x-3">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div>
            <p class="text-sm font-medium text-blue-800 dark:text-blue-300">Information</p>
            <p class="text-xs text-blue-700 dark:text-blue-400 mt-1">
              Le patient sera r√©activ√© et ajout√© √† votre liste de suivi actif. Vous pourrez consulter son historique complet.
            </p>
          </div>
        </div>
      </div>

      <!-- Boutons -->
      <div class="flex gap-3">
        <button
          type="button"
          (click)="closeDesarchiveModal()"
          class="flex-1 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
        >
          Annuler
        </button>
        <button
          (click)="confirmDesarchive()"
          [disabled]="desarchiving"
          class="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 disabled:opacity-50 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center"
        >
          <span *ngIf="!desarchiving">R√©activer</span>
          <span *ngIf="desarchiving" class="flex items-center">
            <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            R√©activation...
          </span>
        </button>
      </div>
    </div>
  </div>

   <!-- ========== MODAL D√âTAILS PATIENT OPTIMIS√âE ========== -->
  <div
    *ngIf="showPatientDetailModal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4"
    (click)="closePatientDetailModal()"
  >
    <div
      class="glass rounded-2xl w-full max-w-7xl max-h-[90vh] overflow-hidden border-2 border-blue-500/30 flex flex-col"
      (click)="$event.stopPropagation()"
    >
      <!-- Header STICKY -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500/10 to-purple-500/10 flex-shrink-0">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <div class="relative">
              <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full blur-lg opacity-50"></div>
              <img
                *ngIf="patientDetails"
                [src]="patientDetails.photoProfil || 'https://ui-avatars.com/api/?name=' + patientDetails.prenom + '+' + patientDetails.nom"
                class="relative w-16 h-16 rounded-full border-2 border-blue-500"
                [alt]="patientDetails.prenom + ' ' + patientDetails.nom"
              >
            </div>
            <div>
              <h3 *ngIf="patientDetails" class="text-2xl font-bold text-gray-900 dark:text-white">
                {{ patientDetails.prenom }} {{ patientDetails.nom }}
              </h3>
              <p *ngIf="patientDetails" class="text-sm text-gray-600 dark:text-gray-400">
                {{ patientDetails.email }}
              </p>
              <p *ngIf="patientDetails?.idDispositif" class="text-xs text-purple-600 dark:text-purple-400 mt-1">
                üìü {{ patientDetails.idDispositif }}
              </p>
            </div>
          </div>
          
          <button
            (click)="closePatientDetailModal()"
            class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
          >
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Contenu scrollable -->
      <div class="p-6 overflow-y-auto flex-1">
        
        <!-- Loading -->
        <div *ngIf="loadingDetails" class="text-center py-12">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
          <p class="mt-4 text-gray-600 dark:text-gray-400">Chargement des d√©tails...</p>
        </div>

        <!-- Donn√©es charg√©es -->
        <div *ngIf="!loadingDetails && patientDetails" class="space-y-6">
          
          <!-- Layout 2 colonnes -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- COLONNE GAUCHE -->
            <div class="space-y-6">
              
              <!-- Statistiques -->
              <div class="grid grid-cols-2 gap-4">
                <div class="glass rounded-xl p-4 text-center">
                  <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">
                    {{ patientStats?.total || 0 }}
                  </div>
                  <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Total</div>
                </div>
                <div class="glass rounded-xl p-4 text-center bg-green-50 dark:bg-green-900/20">
                  <div class="text-3xl font-bold text-green-600 dark:text-green-400">
                    {{ patientStats?.normal || 0 }}
                  </div>
                  <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Normal</div>
                </div>
                <div class="glass rounded-xl p-4 text-center bg-yellow-50 dark:bg-yellow-900/20">
                  <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">
                    {{ patientStats?.attention || 0 }}
                  </div>
                  <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Attention</div>
                </div>
                <div class="glass rounded-xl p-4 text-center bg-red-50 dark:bg-red-900/20">
                  <div class="text-3xl font-bold text-red-600 dark:text-red-400">
                    {{ patientStats?.danger || 0 }}
                  </div>
                  <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Danger</div>
                </div>
              </div>

              <!-- Informations patient -->
              <div class="glass rounded-xl p-4">
                <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-3">Informations</h4>
                <div class="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p class="text-gray-600 dark:text-gray-400">Genre</p>
                    <p class="font-medium text-gray-900 dark:text-white">
                      {{ patientDetails.genre === 'homme' ? 'Homme' : patientDetails.genre === 'femme' ? 'Femme' : 'Autre' }}
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-600 dark:text-gray-400">Date naissance</p>
                    <p class="font-medium text-gray-900 dark:text-white">
                      {{ patientDetails.dateDeNaissance ? formatDate(patientDetails.dateDeNaissance) : 'N/A' }}
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-600 dark:text-gray-400">Dispositif</p>
                    <p class="font-medium text-gray-900 dark:text-white">
                      {{ patientDetails.idDispositif || 'N/A' }}
                    </p>
                  </div>
                  <div>
                    <p class="text-gray-600 dark:text-gray-400">Statut</p>
                    <span
                      [class]="patientDetails.estArchive ? 'bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-400' : 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400'"
                      class="px-2 py-1 rounded-full text-xs font-medium"
                    >
                      {{ patientDetails.estArchive ? 'Archiv√©' : 'Actif' }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Notes m√©dicales (2 derni√®res) -->
              <div class="glass rounded-xl p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-lg font-bold text-gray-900 dark:text-white">
                    Notes ({{ patientNotes.length }})
                  </h4>
                  <button
                    (click)="openNoteModal(patientDetails)"
                    class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition-all"
                  >
                    ‚ûï Nouvelle
                  </button>
                </div>

                <div *ngIf="loadingNotes" class="text-center py-4">
                  <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                </div>

                <div *ngIf="!loadingNotes && patientNotes.length === 0" class="text-center py-4 text-sm text-gray-500">
                  Aucune note
                </div>

                <div *ngIf="!loadingNotes && patientNotes.length > 0" class="space-y-2">
                  <div
                    *ngFor="let note of patientNotes.slice(0, 2)"
                    class="p-3 rounded-lg border text-sm"
                    [class]="getPrioriteBg(note.priorite)"
                  >
                    <div class="flex items-start justify-between mb-2">
                      <span class="text-xs font-bold" [class]="getPrioriteColor(note.priorite)">
                        {{ getTypeLabel(note.type) }}
                      </span>
                      <div class="flex space-x-1">
                        <button
                          (click)="editNote(note)"
                          class="p-1 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded"
                        >
                          <svg class="w-3 h-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                          </svg>
                        </button>
                        <button
                          (click)="deleteNote(note)"
                          class="p-1 hover:bg-red-100 dark:hover:bg-red-900/20 rounded"
                        >
                          <svg class="w-3 h-3 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                          </svg>
                        </button>
                      </div>
                    </div>
                    <p class="text-gray-900 dark:text-white line-clamp-2">
                      {{ note.contenu }}
                    </p>
                    <p class="text-xs text-gray-500 mt-1">
                      {{ formatDate(note.createdAt) }}
                    </p>
                  </div>
                  
                  <button
                    *ngIf="patientNotes.length > 2"
                    (click)="openAllNotesModal()"
                    class="w-full py-2 px-4 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-lg font-bold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 text-sm"
                  >
                    üìã Voir toutes les notes ({{ patientNotes.length }})
                  </button>
                </div>
              </div>
            </div>

            <!-- COLONNE DROITE -->
            <div class="space-y-6">
              
              <!-- Historique mesures (scrollable limit√©) -->
              <div class="glass rounded-xl p-4">
                <h4 class="text-lg font-bold text-gray-900 dark:text-white mb-3">
                  Historique ({{ patientMeasurements.length }} derni√®res)
                </h4>
                
                <div *ngIf="patientMeasurements.length === 0" class="text-center py-4 text-sm text-gray-500">
                  Aucune mesure
                </div>

                <div *ngIf="patientMeasurements.length > 0" class="max-h-96 overflow-y-auto">
                  <table class="w-full text-sm">
                    <thead class="sticky top-0 bg-gray-100 dark:bg-gray-800">
                      <tr>
                        <th class="text-left py-2 px-2 font-semibold">Date</th>
                        <th class="text-left py-2 px-2 font-semibold">BPM</th>
                        <th class="text-left py-2 px-2 font-semibold">SpO2</th>
                        <th class="text-left py-2 px-2 font-semibold">Statut</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let mesure of patientMeasurements" class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="py-2 px-2 text-xs">
                          {{ formatDate(mesure.horodatageMesure) }}
                        </td>
                        <td class="py-2 px-2 font-medium">
                          {{ mesure.bpm }}
                        </td>
                        <td class="py-2 px-2 font-medium">
                          {{ mesure.spo2 }}%
                        </td>
                        <td class="py-2 px-2">
                          <span
                            [class]="getStatusBg(mesure.statut)"
                            class="px-2 py-0.5 rounded-full text-xs font-medium"
                            [class.text-green-700]="mesure.statut === 'NORMAL'"
                            [class.text-yellow-700]="mesure.statut === 'ATTENTION'"
                            [class.text-red-700]="mesure.statut === 'DANGER'"
                          >
                            {{ mesure.statut }}
                          </span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer STICKY avec actions -->
      <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex-shrink-0">
        <div class="flex justify-end space-x-3">
          <button
            *ngIf="!patientDetails?.estArchive"
            (click)="openArchiveModal(patientDetails); closePatientDetailModal()"
            class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all"
          >
            üì¶ Archiver
          </button>
          
          <button
            *ngIf="patientDetails?.estArchive"
            (click)="desarchiverPatient(patientDetails); closePatientDetailModal()"
            class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all"
          >
            ‚ôªÔ∏è R√©activer
          </button>

          <button
            (click)="closePatientDetailModal()"
            class="px-6 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
          >
            Fermer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MODAL NOTES M√âDICALES ========== -->
  <div
    *ngIf="showNoteModal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto"
    (click)="closeNoteModal()"
  >
    <div
      class="glass rounded-2xl max-w-4xl w-full my-8 border-2 border-blue-500/30"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500/10 to-indigo-500/10">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="p-3 bg-blue-500/20 rounded-xl">
              <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                {{ editingNote ? 'Modifier la note' : 'Nouvelle note m√©dicale' }}
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Note confidentielle - Visible uniquement aux m√©decins
              </p>
            </div>
          </div>
          
          <button
            (click)="closeNoteModal()"
            class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
          >
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Formulaire -->
      <div class="p-6">
        <form (ngSubmit)="saveNote()" class="space-y-6">
          
          <!-- Type et Priorit√© -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Type -->
            <div>
              <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                Type de note *
              </label>
              <select
                [(ngModel)]="noteForm.type"
                name="type"
                required
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              >
                <option value="observation">üìä Observation</option>
                <option value="diagnostic">üî¨ Diagnostic</option>
                <option value="prescription">üíä Prescription</option>
                <option value="conseil">üí° Conseil</option>
                <option value="suivi">üìÖ Suivi</option>
                <option value="autre">üìù Autre</option>
              </select>
            </div>

            <!-- Priorit√© -->
            <div>
              <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                Priorit√© *
              </label>
              <select
                [(ngModel)]="noteForm.priorite"
                name="priorite"
                required
                class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              >
                <option value="basse">üü¢ Basse</option>
                <option value="normale">üîµ Normale</option>
                <option value="haute">üü† Haute</option>
                <option value="urgente">üî¥ Urgente</option>
              </select>
            </div>
          </div>

          <!-- Contenu -->
          <div>
            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
              Contenu de la note *
            </label>
            <textarea
              [(ngModel)]="noteForm.contenu"
              name="contenu"
              required
              rows="8"
              placeholder="D√©crivez vos observations, diagnostic, recommandations..."
              class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
            ></textarea>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              {{ noteForm.contenu.length }}/5000 caract√®res
            </p>
          </div>

          <!-- Options -->
          <div class="space-y-3">
            <!-- Note priv√©e -->
            <label class="flex items-center space-x-3 cursor-pointer">
              <input
                type="checkbox"
                [(ngModel)]="noteForm.prive"
                name="prive"
                class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
              >
              <div>
                <span class="font-medium text-gray-900 dark:text-white">Note priv√©e</span>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  Visible uniquement par vous (ne sera pas partag√©e avec d'autres m√©decins)
                </p>
              </div>
            </label>
          </div>

          <!-- Info -->
          <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-500/30">
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <p class="text-sm font-medium text-blue-800 dark:text-blue-300">Information</p>
                <p class="text-xs text-blue-700 dark:text-blue-400 mt-1">
                  Les notes m√©dicales sont horodat√©es et tra√ßables. Elles font partie du dossier m√©dical du patient.
                </p>
              </div>
            </div>
          </div>

          <!-- Boutons -->
          <div class="flex gap-3 pt-4">
            <button
              type="button"
              (click)="closeNoteModal()"
              class="flex-1 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
            >
              Annuler
            </button>
            <button
              type="submit"
              [disabled]="savingNote || !noteForm.contenu.trim()"
              class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 disabled:opacity-50 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center"
            >
              <span *ngIf="!savingNote">üíæ Enregistrer la note</span>
              <span *ngIf="savingNote" class="flex items-center">
                <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Enregistrement...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ========== MODAL TOUTES LES NOTES ========== -->
  <div
    *ngIf="showAllNotesModal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4"
    (click)="closeAllNotesModal()"
  >
    <div
      class="glass rounded-2xl max-w-4xl w-full max-h-[80vh] overflow-hidden border-2 border-blue-500/30"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-blue-500/10 to-indigo-500/10">
        <div class="flex items-center justify-between">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
            Notes m√©dicales ({{ patientNotes.length }})
          </h3>
          <button
            (click)="closeAllNotesModal()"
            class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
          >
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Liste compl√®te -->
      <div class="p-6 overflow-y-auto max-h-[60vh]">
        <div class="space-y-4">
          <div
            *ngFor="let note of patientNotes"
            class="glass rounded-lg p-4 border-2"
            [class]="getPrioriteBg(note.priorite)"
          >
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center space-x-2">
                <span class="px-3 py-1 rounded-full text-xs font-bold" [class]="getPrioriteBg(note.priorite) + ' ' + getPrioriteColor(note.priorite)">
                  {{ getTypeLabel(note.type) }}
                </span>
                <span class="px-2 py-1 rounded-full text-xs font-medium" [class]="getPrioriteBg(note.priorite)">
                  {{ note.priorite }}
                </span>
                <span *ngIf="note.prive" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded-full text-xs font-medium">
                  üîí Priv√©
                </span>
              </div>
              
              <div class="flex space-x-1">
                <button
                  (click)="editNote(note)"
                  class="p-2 hover:bg-blue-100 dark:hover:bg-blue-900/20 rounded-lg transition-all"
                >
                  <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                </button>
                <button
                  (click)="deleteNote(note)"
                  class="p-2 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-lg transition-all"
                >
                  <svg class="w-4 h-4 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </div>

            <p class="text-sm text-gray-900 dark:text-white whitespace-pre-wrap mb-3">
              {{ note.contenu }}
            </p>

            <div class="flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 pt-3 border-t border-gray-300 dark:border-gray-600">
              <span>Par <strong>Dr. {{ note.medecinId?.prenom }} {{ note.medecinId?.nom }}</strong></span>
              <span>{{ formatDate(note.createdAt) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

</div> <!-- Fin du container principal -->

    <!-- ========== MODAL COMPARAISON PATIENTS ========== -->
  <div
    *ngIf="showComparaisonModal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-center justify-center p-4"
    (click)="closeComparaisonModal()"
  >
    <div
      class="glass rounded-2xl max-w-5xl w-full max-h-[85vh] overflow-hidden border-2 border-purple-500/30"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-500/10 to-pink-500/10">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="p-3 bg-purple-500/20 rounded-xl">
              <svg class="w-8 h-8 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                Comparaison Multi-Patients
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                S√©lectionnez 2 √† {{ maxPatientsComparaison }} patients ({{ patientsComparaison.length }} s√©lectionn√©s)
              </p>
            </div>
          </div>
          
          <button
            (click)="closeComparaisonModal()"
            class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
          >
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Liste patients -->
      <div class="p-6 overflow-y-auto max-h-[60vh]">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div
            *ngFor="let patient of patients"
            (click)="togglePatientComparaison(patient.id)"
            [class.ring-4]="isPatientSelected(patient.id)"
            [class.ring-purple-500]="isPatientSelected(patient.id)"
            [class.bg-purple-50]="isPatientSelected(patient.id)"
            [class.dark:bg-purple-900/20]="isPatientSelected(patient.id)"
            class="glass rounded-xl p-4 cursor-pointer hover:shadow-lg transition-all border-2 border-gray-200 dark:border-gray-700"
          >
            <div class="flex items-center space-x-3">
              <!-- Checkbox -->
              <div class="flex-shrink-0">
                <div
                  [class.bg-purple-500]="isPatientSelected(patient.id)"
                  [class.border-purple-500]="isPatientSelected(patient.id)"
                  class="w-6 h-6 rounded-lg border-2 border-gray-300 dark:border-gray-600 flex items-center justify-center transition-all"
                >
                  <svg *ngIf="isPatientSelected(patient.id)" class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                  </svg>
                </div>
              </div>

              <!-- Photo + Info -->
              <div class="flex items-center space-x-2 flex-1 min-w-0">
                <img
                  [src]="patient.photoProfil || 'https://ui-avatars.com/api/?name=' + patient.prenom + '+' + patient.nom"
                  [alt]="patient.prenom + ' ' + patient.nom"
                  class="w-10 h-10 rounded-full border-2 border-gray-300 dark:border-gray-600"
                >
                <div class="flex-1 min-w-0">
                  <p class="font-bold text-gray-900 dark:text-white truncate">
                    {{ patient.prenom }} {{ patient.nom }}
                  </p>
                  <p class="text-xs text-gray-600 dark:text-gray-400 truncate">
                    {{ patient.email }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Message si aucun patient -->
        <div *ngIf="patients.length === 0" class="text-center py-12 text-gray-500">
          <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>
          <p>Aucun patient disponible</p>
        </div>
      </div>

      <!-- Footer -->
      <div class="p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
        <div class="flex items-center justify-between">
          <p class="text-sm text-gray-600 dark:text-gray-400">
            <span class="font-bold text-purple-600 dark:text-purple-400">{{ patientsComparaison.length }}</span> / {{ maxPatientsComparaison }} patients s√©lectionn√©s
          </p>

          <div class="flex gap-3">
            <button
              (click)="closeComparaisonModal()"
              class="px-6 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
            >
              Annuler
            </button>
            <button
              (click)="lancerComparaison()"
              [disabled]="patientsComparaison.length < 2"
              class="px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-bold transition-all shadow-lg hover:shadow-xl"
            >
              üìä Comparer ({{ patientsComparaison.length }})
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MODAL R√âPONDRE QUESTION ========== -->
  <div
    *ngIf="showReponseModal && selectedQuestion"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] flex items-center justify-center p-4"
    (click)="closeReponseModal()"
  >
    <div
      class="glass rounded-2xl max-w-3xl w-full border-2 border-purple-500/30"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-500/10 to-pink-500/10">
        <div class="flex items-center justify-between">
          <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
            R√©pondre √† {{ selectedQuestion.patientId?.prenom }} {{ selectedQuestion.patientId?.nom }}
          </h3>
          <button
            (click)="closeReponseModal()"
            class="p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-all"
          >
            <svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Question -->
      <div class="p-6">
        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl mb-6">
          <p class="text-sm font-bold text-blue-600 dark:text-blue-400 mb-2">Question du patient :</p>
          <p class="text-gray-900 dark:text-white">{{ selectedQuestion.question }}</p>
        </div>

        <!-- Zone r√©ponse -->
        <label class="block text-sm font-bold text-gray-900 dark:text-white mb-2">
          Votre r√©ponse
        </label>
        <textarea
          [(ngModel)]="reponseText"
          rows="6"
          maxlength="1000"
          placeholder="R√©digez votre r√©ponse ici..."
          class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
        ></textarea>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
          {{ reponseText.length }}/1000 caract√®res
        </p>
      </div>

      <!-- Footer -->
      <div class="p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
        <div class="flex gap-3">
          <button
            (click)="closeReponseModal()"
            class="flex-1 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl font-bold text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
          >
            Annuler
          </button>
          <button
            (click)="envoyerReponse()"
            [disabled]="sendingReponse || !reponseText.trim()"
            class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 disabled:opacity-50 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-xl flex items-center justify-center"
          >
            <span *ngIf="!sendingReponse">üì§ Envoyer la r√©ponse</span>
            <span *ngIf="sendingReponse" class="flex items-center">
              <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Envoi...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>




  





  

 
